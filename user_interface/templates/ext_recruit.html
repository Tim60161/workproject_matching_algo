{% extends "layout.html" %}

{% block title %}
External Recruiting
{% endblock %}

{% block main %}
<h1>External Recruiting</h1>
<div>
    <!-- [Content omitted for brevity] -->
</div>

<div>
    <h2>List of Candidates</h2>
    <ul>
        {% for applicant in applicants %}
            <li>{{ applicant }}</li>
        {% else %}
            <li>No candidates uploaded.</li>
        {% endfor %}
    </ul>
</div>

<!-- Upload Resumes Button -->
<div>
    <h2>Upload Resumes</h2>
    <form method="post" enctype="multipart/form-data">
        <input type="file" name="files" multiple required>
        <input type="submit" value="Upload" class="action-button upload-button">
    </form>
</div>

<!-- Run Analysis Button -->
<div>
    <h2>Run Analysis</h2>
    <form method="get" action="{{ url_for('ext_recruit') }}" id="analysis-form">
        <button type="submit" name="analyze" value="1" class="action-button run-button" {% if not applicants %}disabled{% endif %}>Run Similarity Analysis</button>
    </form>
</div>

<!-- Loading Spinner Overlay -->
<div id="loading-overlay">
    <div class="spinner"></div>
    <p>Running analysis, please wait...</p>
</div>

<!-- Analysis Results -->
<div>
    {% if analysis_data %}
        <h2>Analysis Results</h2>
        <table border="1">
            <tr>
                <th>Name</th>
                <th>Degrees</th>
                <th>Max Degree Level</th>
                <th>Acceptable Majors</th>
                <th>Skills</th>
            </tr>
            {% for item in analysis_data %}
            <tr>
                <td>{{ item.name or 'N/A' }}</td>
                <td>{{ item.Degrees | join(', ') if item.Degrees else 'N/A' }}</td>
                <td>{{ item['Maximum degree level'] or 'N/A' }}</td>
                <td>{{ item['Acceptable majors'] | join(', ') if item['Acceptable majors'] else 'N/A' }}</td>
                <td>{{ item.Skills | join(', ') if item.Skills else 'N/A' }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No analysis data available.</p>
    {% endif %}
</div>
<!-- Clear All Results Button -->
<div style="padding: 10px 0px;">
    <form method="post" action="{{ url_for('clear_results') }}" onsubmit="return confirm('Are you sure you want to delete all uploaded resumes and clear results?');">
        <button type="submit" class="action-button clear-button" {% if not applicants %}disabled{% endif %}>Clear All Results</button>
    </form>
</div>

{% endblock %}

{% block styles %}
<style>
    /* Loading Overlay Styles */
    #loading-overlay {
        display: none; /* Hidden by default */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        z-index: 9999;
        text-align: center;
        padding-top: 200px;
    }

    /* Spinner Styles */
    .spinner {
        margin: 0 auto 20px auto;
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
    }

    /* Spinner Animation */
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Button Styles */
    /* Base styles for all action buttons */
    .action-button {
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    .action-button:hover {
        opacity: 0.9;
    }

    .action-button:disabled {
        background-color: grey;
        cursor: not-allowed;
    }

    /* Clear All Results Button */
    .clear-button {
        background-color: red;
    }

    .clear-button:hover {
        background-color: darkred;
    }

    /* Run Analysis Button */
    .run-button {
        background-color: blue;
    }

    .run-button:hover {
        background-color: darkblue;
    }

    /* Upload Button */
    .upload-button {
        background-color: green;
    }

    .upload-button:hover {
        background-color: darkgreen;
    }


</style>
{% endblock %}

{% block scripts %}
<script>
    // Show the loading overlay when the analysis form is submitted
    document.getElementById('analysis-form').addEventListener('submit', function() {
        document.getElementById('loading-overlay').style.display = 'block';
    });
</script>
{% endblock %}
